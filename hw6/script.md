## encoding

| encoding  | p1  | p2  | d1  | p4  | d2  | d3  | d4  | p8  | d5  | d6  | d7  | d8  | d9  | d10 |
| --------- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| bit pos   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  |
| bit value |     |     | 1   |     | 0   | 0   | 1   |     | 0   | 1   | 1   | 0   | 0   | 1   |
| p1        | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     |
| p2        |     | x   | x   |     |     | x   | x   |     |     | x   | x   |     |     | x   |
| p4        |     |     |     | x   | x   | x   | x   |     |     |     |     | x   | x   | x   |
| p8        |     |     |     |     |     |     |     | x   | x   | x   | x   | x   | x   | x   |

(under xor addition)

p1 = 1 + 0 + 1 + 0 + 1 + 0 = 1
p2 = 1 + 0 + 1 + 1 + 1 + 1 = 1
p4 = 0 + 0 + 1 + 0 + 0 + 1 = 0
p8 = 0 + 1 + 1 + 0 + 0 + 1 = 1

C\p11 = 11 1 0 001 1 011001

p11 = sum(11 1 0 001 1 011001) = 0

=> C = 11 1 0 001 1 011001 0

## decoding (b)

| decoding  | p1  | p2  | d1  | p4  | d2  | d3  | d4  | p8  | d5  | d6  | d7  | d8  | d9  | d10 | p11 |
| --------- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| bit pos   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | 15  |
| bit value | 1   | 1   | 1   | 0   | 0   | 0   | 1   | 1   | 0   | 1   | 1   | 0   | 0   | 1   | 0   |
| p1        | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     |     |
| p2        |     | x   | x   |     |     | x   | x   |     |     | x   | x   |     |     | x   |     |
| p4        |     |     |     | x   | x   | x   | x   |     |     |     |     | x   | x   | x   |     |
| p8        |     |     |     |     |     |     |     | x   | x   | x   | x   | x   | x   | x   |     |

h1 = 1 + 1 + 0 + 1 + 0 + 1 + 0 = 0
h2 = 1 + 1 + 0 + 1 + 1 + 1 + 1 = 0
h4 = 0 + 0 + 0 + 1 + 0 + 0 + 1 = 0
h8 = 1 + 0 + 1 + 1 + 0 + 0 + 1 = 0
hn = 0

=> no errors

## decoding (c)

| decoding  | p1  | p2  | d1  | p4  | d2  | d3  | d4  | p8  | d5  | d6  | d7  | d8  | d9  | d10 | p11 |
| --------- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| bit pos   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | 15  |
| bit value | 1   | 1   | 1   | 0   | 0   | 0   | 1   | 1   | 1   | 1   | 1   | 0   | 0   | 1   | 0   |
| p1        | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     |     |
| p2        |     | x   | x   |     |     | x   | x   |     |     | x   | x   |     |     | x   |     |
| p4        |     |     |     | x   | x   | x   | x   |     |     |     |     | x   | x   | x   |     |
| p8        |     |     |     |     |     |     |     | x   | x   | x   | x   | x   | x   | x   |     |

h1 = 1 + 1 + 0 + 1 + 0 + 1 + 0 = 1
h2 = 1 + 1 + 0 + 1 + 1 + 1 + 1 = 0
h4 = 0 + 0 + 0 + 1 + 0 + 0 + 1 = 0
h8 = 1 + 0 + 1 + 1 + 0 + 0 + 1 = 1
hn = 1

=> single error in pos 1001_2 = 9: d5


## decoding (d)

| decoding  | p1  | p2  | d1  | p4  | d2  | d3  | d4  | p8  | d5  | d6  | d7  | d8  | d9  | d10 | p11 |
| --------- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| bit pos   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | 15  |
| bit value | 0   | 1   | 1   | 0   | 0   | 0   | 1   | 1   | 0   | 1   | 1   | 1   | 0   | 1   | 0   |
| p1        | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     |     |
| p2        |     | x   | x   |     |     | x   | x   |     |     | x   | x   |     |     | x   |     |
| p4        |     |     |     | x   | x   | x   | x   |     |     |     |     | x   | x   | x   |     |
| p8        |     |     |     |     |     |     |     | x   | x   | x   | x   | x   | x   | x   |     |

h1 = 1 + 1 + 0 + 1 + 0 + 1 + 0 = 1
h2 = 1 + 1 + 0 + 1 + 1 + 1 + 1 = 0
h4 = 0 + 0 + 0 + 1 + 0 + 0 + 1 = 1
h8 = 1 + 0 + 1 + 1 + 0 + 0 + 1 = 1
hn = 0

=> double error detected


## decoding (e)

| decoding  | p1  | p2  | d1  | p4  | d2  | d3  | d4  | p8  | d5  | d6  | d7  | d8  | d9  | d10 | p11 |
| --------- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| bit pos   | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   | 10  | 11  | 12  | 13  | 14  | 15  |
| bit value | 0   | 1   | 1   | 0   | 0   | 0   | 1   | 1   | 0   | 1   | 1   | 1   | 0   | 1   | 1   |
| p1        | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     | x   |     |     |
| p2        |     | x   | x   |     |     | x   | x   |     |     | x   | x   |     |     | x   |     |
| p4        |     |     |     | x   | x   | x   | x   |     |     |     |     | x   | x   | x   |     |
| p8        |     |     |     |     |     |     |     | x   | x   | x   | x   | x   | x   | x   |     |

h1 = 1 + 1 + 0 + 1 + 0 + 1 + 0 = 1
h2 = 1 + 1 + 0 + 1 + 1 + 1 + 1 = 0
h4 = 0 + 0 + 0 + 1 + 0 + 0 + 1 = 1
h8 = 1 + 0 + 1 + 1 + 0 + 0 + 1 = 1
hn = 1

=> single error at pos 1101_2 = 13: d9

=> in fact, not at d9 (ED failed)

## f

since p = 8 is the minimum solution to 

2^p >= p + 128 + 1

plus one additional parity bit => a total of 9 parity bits

# 3

(a): 4

(b): 2^5 = 32

(c): 


# 5

\# of bits for:

- Block offset: lg(16) = 4

- Index: lg(4) = 2

- Tag: 12 - 4 - 2 = 6

initial: 

| set | R   | V0  | D0  | Tag0   | Data0          | V1  | D1  | Tag1 | Data1 |
| --- | --- | --- | --- | ------ | -------------- | --- | --- | ---- | ----- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f] | 0   |     |      |       |
| 1   |     | 0   |     |        |                | 0   |     |      |       |
| 2   |     | 0   |     |        |                | 0   |     |      |       |
| 3   |     | 0   |     |        |                | 0   |     |      |       |

1. (# of no.) Read 0x340

Tag/Index/Offset: 001101 00 0000

=> $miss, load

| set | R   | V0  | D0  | Tag0   | Data0          | V1  | D1  | Tag1   | Data1          |
| --- | --- | --- | --- | ------ | -------------- | --- | --- | ------ | -------------- |
| 0   | 0   | 1   | 0   | 000000 | Mem[0x000-00f] | 1   | 0   | 001101 | Mem[0x340-34f] |
| 1   |     | 0   |     |        |                | 0   |     |        |                |
| 2   |     | 0   |     |        |                | 0   |     |        |                |
| 3   |     | 0   |     |        |                | 0   |     |        |                |

2. Read 0x000

Tag/Index/Offset: 000000 00 0000

=> $hit

| set | R   | V0  | D0  | Tag0   | Data0          | V1  | D1  | Tag1   | Data1          |
| --- | --- | --- | --- | ------ | -------------- | --- | --- | ------ | -------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f] | 1   | 0   | 001101 | Mem[0x340-34f] |
| 1   |     | 0   |     |        |                | 0   |     |        |                |
| 2   |     | 0   |     |        |                | 0   |     |        |                |
| 3   |     | 0   |     |        |                | 0   |     |        |                |

3. Read 0x1d8

Tag/Index/Offset: 000111 01 1000

=> $miss, load

| set | R   | V0  | D0  | Tag0   | Data0          | V1  | D1  | Tag1   | Data1          |
| --- | --- | --- | --- | ------ | -------------- | --- | --- | ------ | -------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f] | 1   | 0   | 001101 | Mem[0x340-34f] |
| 1   | 1   | 1   | 0   | 000111 | Mem[0x1d0-1df] | 0   |     |        |                |
| 2   |     | 0   |     |        |                | 0   |     |        |                |
| 3   |     | 0   |     |        |                | 0   |     |        |                |

4. Write 0x354

Tag/Index/Offset: 001101 01 0100

=> $miss, write allo., mark dirty

| set | R   | V0  | D0  | Tag0   | Data0          | V1  | D1  | Tag1   | Data1           |
| --- | --- | --- | --- | ------ | -------------- | --- | --- | ------ | --------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f] | 1   | 0   | 001101 | Mem[0x340-34f]  |
| 1   | 0   | 1   | 0   | 000111 | Mem[0x1d0-1df] | 1   | 1   | 001101 | Mem[0x350-35f]' |
| 2   |     | 0   |     |        |                | 0   |     |        |                 |
| 3   |     | 0   |     |        |                | 0   |     |        |                 |

5. Read 0xa61

Tag/Index/Offset: 101001 10 0001

=> $miss, load

| set | R   | V0  | D0  | Tag0   | Data0          | V1  | D1  | Tag1   | Data1           |
| --- | --- | --- | --- | ------ | -------------- | --- | --- | ------ | --------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f] | 1   | 0   | 001101 | Mem[0x340-34f]  |
| 1   | 0   | 1   | 0   | 000111 | Mem[0x1d0-1df] | 1   | 1   | 001101 | Mem[0x350-35f]' |
| 2   | 1   | 1   | 0   | 101001 | Mem[0xa60-a6f] | 0   |     |        |                 |
| 3   |     | 0   |     |        |                | 0   |     |        |                 |

6. Write 0xa61

Tag/Index/Offset: 101001 10 0001

=> $hit, mark dirty

| set | R   | V0  | D0  | Tag0   | Data0           | V1  | D1  | Tag1   | Data1           |
| --- | --- | --- | --- | ------ | --------------- | --- | --- | ------ | --------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f]  | 1   | 0   | 001101 | Mem[0x340-34f]  |
| 1   | 0   | 1   | 0   | 000111 | Mem[0x1d0-1df]  | 1   | 1   | 001101 | Mem[0x350-35f]' |
| 2   | 1   | 1   | 1   | 101001 | Mem[0xa60-a6f]' | 0   |     |        |                 |
| 3   |     | 0   |     |        |                 | 0   |     |        |                 |

7. Read 0x3ec

Tag/Index/Offset: 001111 10 1100

=> $miss, load

| set | R   | V0  | D0  | Tag0   | Data0           | V1  | D1  | Tag1   | Data1           |
| --- | --- | --- | --- | ------ | --------------- | --- | --- | ------ | --------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f]  | 1   | 0   | 001101 | Mem[0x340-34f]  |
| 1   | 0   | 1   | 0   | 000111 | Mem[0x1d0-1df]  | 1   | 1   | 001101 | Mem[0x350-35f]' |
| 2   | 0   | 1   | 1   | 101001 | Mem[0xa60-a6f]' | 1   | 0   | 001111 | Mem[0x3e0-3ef]  |
| 3   |     | 0   |     |        |                 | 0   |     |        |                 |

8. Read 0xa62

Tag/Index/Offset: 101001 10 0010

=> $hit

| set | R   | V0  | D0  | Tag0   | Data0           | V1  | D1  | Tag1   | Data1           |
| --- | --- | --- | --- | ------ | --------------- | --- | --- | ------ | --------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f]  | 1   | 0   | 001101 | Mem[0x340-34f]  |
| 1   | 0   | 1   | 0   | 000111 | Mem[0x1d0-1df]  | 1   | 1   | 001101 | Mem[0x350-35f]' |
| 2   | 1   | 1   | 1   | 101001 | Mem[0xa60-a6f]' | 1   | 0   | 001111 | Mem[0x3e0-3ef]  |
| 3   |     | 0   |     |        |                 | 0   |     |        |                 |

9. Read 0x3ea

Tag/Index/Offset: 001111 10 1010

=> $hit

| set | R   | V0  | D0  | Tag0   | Data0           | V1  | D1  | Tag1   | Data1           |
| --- | --- | --- | --- | ------ | --------------- | --- | --- | ------ | --------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f]  | 1   | 0   | 001101 | Mem[0x340-34f]  |
| 1   | 0   | 1   | 0   | 000111 | Mem[0x1d0-1df]  | 1   | 1   | 001101 | Mem[0x350-35f]' |
| 2   | 0   | 1   | 1   | 101001 | Mem[0xa60-a6f]' | 1   | 0   | 001111 | Mem[0x3e0-3ef]  |
| 3   |     | 0   |     |        |                 | 0   |     |        |                 |

10. Read 0x422

Tag/Index/Offset: 010000 10 0010

=> $miss, block replacement: way 0, write back happens; after: load

| set | R   | V0  | D0  | Tag0   | Data0          | V1  | D1  | Tag1   | Data1           |
| --- | --- | --- | --- | ------ | -------------- | --- | --- | ------ | --------------- |
| 0   | 1   | 1   | 0   | 000000 | Mem[0x000-00f] | 1   | 0   | 001101 | Mem[0x340-34f]  |
| 1   | 0   | 1   | 0   | 000111 | Mem[0x1d0-1df] | 1   | 1   | 001101 | Mem[0x350-35f]' |
| 2   | 1   | 1   | 0   | 010000 | Mem[0x420-42f] | 1   | 0   | 001111 | Mem[0x3e0-3ef]  |
| 3   |     | 0   |     |        |                | 0   |     |        |                 |

# 7

4KB = 2^2*2^10 Bytes = 2^12 bytes => page offset = 12

=> Tag size = 4*4 - 12 = 4

- hit/miss in TLB
- any page fault?
- updated TLB

initial state:

TLB:

|  V  | Tag | phy-page num. |  R  | Replacement Pointer |
| :-: | :-: | :-----------: | :-: | :-----------------: |
|  1  | 0x4 |       6       |  1  |          V          |
|  1  | 0x1 |       2       |  0  |                     |
|  1  | 0xa |       3       |  1  |                     |
|  0  | 0x3 |       5       |  0  |                     |

Page table:

| index |  V  | phy-page num or in disk |
| :---: | :-: | :---------------------: |
|   0   |  0  |            D            |
|   1   |  1  |            2            |
|   2   |  0  |            D            |
|   3   |  1  |            5            |
|   4   |  1  |            6            |
|   5   |  1  |           11            |
|   6   |  1  |            7            |
|   7   |  0  |            D            |
|   8   |  0  |            D            |
|   9   |  0  |            D            |
|   a   |  1  |            3            |
|   b   |  0  |            D            |


1. 0x5368

tag: 0x5

=> $miss, no page fault

section in page table:

| index |  V  | phy-page num or in disk |
| :---: | :-: | :---------------------: |
|   5   |  1  |           11            |

TLB:

|  V  | Tag | phy-page num. |  R  | Replacement Pointer |
| :-: | :-: | :-----------: | :-: | :-----------------: |
|  1  | 0x4 |       6       |  1  |          V          |
|  1  | 0x1 |       2       |  0  |                     |
|  1  | 0xa |       3       |  1  |                     |
|  1  | 0x5 |      11       |  1  |                     |

2. 0x02c3

tag: 0x0

=> $miss + replacement, page fault

updated section in page table:

| index |  V  | phy-page num or in disk |
| :---: | :-: | :---------------------: |
|   0   |  1  |            1            |

TLB:

|  V  | Tag | phy-page num. |  R  | Replacement Pointer |
| :-: | :-: | :-----------: | :-: | :-----------------: |
|  1  | 0x4 |       6       |  0  |                     |
|  1  | 0x0 |       1       |  1  |                     |
|  1  | 0xa |       3       |  1  |          V          |
|  1  | 0x5 |      11       |  1  |                     |

3. 0x434b

tag: 0x4

=> $hit, reset others's R

|  V  | Tag | phy-page num. |  R  | Replacement Pointer |
| :-: | :-: | :-----------: | :-: | :-----------------: |
|  1  | 0x4 |       6       |  1  |                     |
|  1  | 0x0 |       1       |  0  |                     |
|  1  | 0xa |       3       |  0  |          V          |
|  1  | 0x5 |      11       |  0  |                     |

4. 0x6812

tag: 0x6

=> $miss + replacement, no page fault

section in page table:

| index |  V  | phy-page num or in disk |
| :---: | :-: | :---------------------: |
|   6   |  1  |            7            |

TLB:

|  V  | Tag | phy-page num. |  R  | Replacement Pointer |
| :-: | :-: | :-----------: | :-: | :-----------------: |
|  1  | 0x4 |       6       |  1  |                     |
|  1  | 0x0 |       1       |  0  |                     |
|  1  | 0x6 |       7       |  1  |                     |
|  1  | 0x5 |      11       |  0  |          V          |

5. 0xaf50

tag: 0xa

=> $miss + replacement, no page fault

section in page table:

| index |  V  | phy-page num or in disk |
| :---: | :-: | :---------------------: |
|   a   |  1  |            3            |

TLB:

|  V  | Tag | phy-page num. |  R  | Replacement Pointer |
| :-: | :-: | :-----------: | :-: | :-----------------: |
|  1  | 0x4 |       6       |  1  |          V          |
|  1  | 0x0 |       1       |  0  |                     |
|  1  | 0x6 |       7       |  1  |                     |
|  1  | 0xa |       3       |  1  |                     |

